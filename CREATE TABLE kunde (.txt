CREATE TABLE kunde (
  kd_nr INT PRIMARY KEY,
  name VARCHAR(100),
  vorname VARCHAR(100),
  strasse VARCHAR(100),
  haus_nr VARCHAR(10),
  plz VARCHAR(10),
  ort VARCHAR(100),
  geburtsdatum DATE,
  deleted_at TIMESTAMP NULL
);

CREATE TABLE bestellung (
  bestell_nr INT PRIMARY KEY,
  kd_nr INT,
  gesamtpreis DECIMAL(10,2),
  datum DATE,
  FOREIGN KEY (kd_nr) REFERENCES kunde(kd_nr)
);

CREATE TABLE ernaehrungskategorie (
  kategorie_id INT PRIMARY KEY,
  kategorie_name ENUM('Vegan', 'Vegetarisch', 'Frutarisch', 'Low Carb', 'High Protein')
);

CREATE TABLE rezept (
  rezept_id INT PRIMARY KEY,
  rezeptname VARCHAR(100),
  kategorie_id INT,
  FOREIGN KEY (kategorie_id) REFERENCES ernaehrungskategorie(kategorie_id)
);

CREATE TABLE zutat (
  zutat_id INT PRIMARY KEY,
  zutatname VARCHAR(100),
  bestand INT,
  nettopreis DECIMAL(10,2),
  fett_pro_einheit DECIMAL(5,2),
  kalorien_pro_einheit DECIMAL(5,2),
  kohlenhydrat_pro_einheit DECIMAL(5,2),
  mengeneinheit VARCHAR(20),
  lief_nr INT,
  deleted_at TIMESTAMP NULL,
  FOREIGN KEY (lief_nr) REFERENCES lieferant(lief_nr)
);

CREATE TABLE lieferant (
  lief_nr INT PRIMARY KEY,
  name VARCHAR(100),
  stadt VARCHAR(100),
  plz VARCHAR(10),
  haus_nr VARCHAR(10)
);

CREATE TABLE rezept_zutat (
  rezept_id INT,
  zutat_id INT,
  menge DECIMAL(10,2),
  PRIMARY KEY (rezept_id, zutat_id),
  FOREIGN KEY (rezept_id) REFERENCES rezept(rezept_id),
  FOREIGN KEY (zutat_id) REFERENCES zutat(zutat_id)
);

CREATE TABLE allergen (
  allergen_id INT PRIMARY KEY,
  allergen_name VARCHAR(100)
);

CREATE TABLE rezept_allergen (
  rezept_id INT,
  allergen_id INT,
  PRIMARY KEY (rezept_id, allergen_id),
  FOREIGN KEY (rezept_id) REFERENCES rezept(rezept_id),
  FOREIGN KEY (allergen_id) REFERENCES allergen(allergen_id)
);

CREATE TABLE beschraenkung (
  beschraenk_id INT PRIMARY KEY,
  name VARCHAR(100),
  kategorie_id INT,
  FOREIGN KEY (kategorie_id) REFERENCES ernaehrungskategorie(kategorie_id)
);

CREATE TABLE zutat_beschraenkung (
  zutat_id INT,
  beschraenk_id INT,
  PRIMARY KEY (zutat_id, beschraenk_id),
  FOREIGN KEY (zutat_id) REFERENCES zutat(zutat_id),
  FOREIGN KEY (beschraenk_id) REFERENCES beschraenkung(beschraenk_id)
);

CREATE TABLE kunde_beschraenkung (
  kd_nr INT,
  beschraenk_id INT,
  PRIMARY KEY (kd_nr, beschraenk_id),
  FOREIGN KEY (kd_nr) REFERENCES kunde(kd_nr),
  FOREIGN KEY (beschraenk_id) REFERENCES beschraenkung(beschraenk_id)
);

CREATE TABLE bestellung_zutat (
  bestell_nr INT,
  zutat_id INT,
  menge DECIMAL(10,2),
  PRIMARY KEY (bestell_nr, zutat_id),
  FOREIGN KEY (bestell_nr) REFERENCES bestellung(bestell_nr),
  FOREIGN KEY (zutat_id) REFERENCES zutat(zutat_id)
);
